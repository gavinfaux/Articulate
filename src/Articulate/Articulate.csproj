<!--TODO: Review all of this for netcore / Umbraco 14+ -->

<Project Sdk="Microsoft.NET.Sdk.Razor">
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
    <StaticWebAssetBasePath>/</StaticWebAssetBasePath>
    <!--<OutputType>Library</OutputType>-->
    <SolutionDir Condition="$(SolutionDir) == '' Or $(SolutionDir) == '*Undefined*'">..\</SolutionDir>
  </PropertyGroup>

  <!-- Nuget Package -->
  <PropertyGroup>
    <PackageId>Articulate</PackageId>
    <Authors>Shannon Deminick</Authors>
    <Description>A wonderful Blog engine built on Umbraco</Description>
    <PackageIcon>Icon-transparent.png</PackageIcon>
    <PackageTags>blog umbraco umbraco-marketplace oss tags markdown richtext</PackageTags>
    <PackageProjectUrl>https://github.com/Shazwazza/Articulate</PackageProjectUrl>
    <RepositoryType>git</RepositoryType>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
    <Company>Shannon Deminick</Company>
    <Copyright>Copyright Â© $(Company) $([System.DateTime]::Now.Year)</Copyright>
    <PackageReadmeFile>README.md</PackageReadmeFile>
  </PropertyGroup>
    
  <!--
  Nuget - Dotnet SourceLink & Symbol Package
  https://github.com/dotnet/sourcelink#using-source-link-in-net-projects
  https://devblogs.microsoft.com/dotnet/producing-packages-with-source-link/

  Newer recommended way from Claire Novotny - Nuget PM
  Use package Dotnet.ReproducibleBuilds
  This sets the same properties as above URLs and a few additional build properties
  ie less work - just include this package & be done...
  https://github.com/dotnet/reproducible-builds  
  -->
  <ItemGroup>
    <PackageReference Include="DotNet.ReproducibleBuilds" Version="1.2.25">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
    </PackageReference>
  </ItemGroup>  

  <ItemGroup>
    <None Include="build\**\*.*">
      <Pack>True</Pack>
      <PackagePath>buildTransitive</PackagePath>
    </None>
  </ItemGroup>

  <ItemGroup>
    <None Remove="App_Plugins\Articulate\BackOffice\assets\themes.css" />
    <None Remove="Packaging\package.zip" />
  </ItemGroup>

  <ItemGroup>
    <Compile Update="Controllers\Resources.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>Resources.resx</DependentUpon>
    </Compile>
  </ItemGroup>
  
  <ItemGroup>
    <EmbeddedResource Update="Controllers\Resources.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>Resources.Designer.cs</LastGenOutput>
    </EmbeddedResource>
  </ItemGroup>
  
  <ItemGroup>
    <EmbeddedResource Include="Packaging\author.jpg" />
    <EmbeddedResource Include="Packaging\banner.jpg" />
    <EmbeddedResource Include="Packaging\logo.png" />
    <EmbeddedResource Include="Packaging\package.zip" />
    <EmbeddedResource Include="Packaging\post1.jpg" />
    <EmbeddedResource Include="Packaging\post2.jpg" />
  </ItemGroup>


  <!-- TODO: Error NETSDK1022	Duplicate 'Content' items were included. The .NET SDK includes 'Content' items from your project directory by default. 
  You can either remove these items from your project file, or set the 'EnableDefaultContentItems' property to 'false' if you want to explicitly include them in your project file. 
  For more information, see https://aka.ms/sdkimplicititems.
  -->
  <!-- 
  <ItemGroup>
    <Content Include="App_Plugins/**/*.*">
      <Pack>true</Pack>
      <PackagePath>App_Plugins</PackagePath>
    </Content>
  </ItemGroup>
  -->

  <!-- Nuget Package Dependencies -->
  <ItemGroup>
    <PackageReference Include="Argotic.Core" Version="3001.0.0" />
    <PackageReference Include="Smidge" Version="4.5.1" />
    <PackageReference Include="System.ServiceModel.Syndication" Version="9.0.5" />
    <PackageReference Include="Umbraco.Cms.Web.Website" Version="15.4.1" />
    <PackageReference Include="Umbraco.Cms.Web.Common" Version="15.4.1" />
    <PackageReference Include="Umbraco.Cms.Api.Common" Version="15.4.1" />
    <PackageReference Include="Umbraco.Cms.Api.Management" Version="15.4.1" />
    <PackageReference Include="WilderMinds.MetaWeblog" Version="5.1.3" />
  </ItemGroup>
  
  <ItemGroup>
    <FrameworkReference Include="Microsoft.AspNetCore.App" />
  </ItemGroup>

  <ItemGroup>
    <ClientAssetsInputs Include="Client\**" Exclude="$(DefaultItemExcludes)" />
    <!-- Dont include the client folder as part of packaging nuget build -->
    <Content Remove="Client\**" />
    <!-- However make the Umbraco-package.json included for dotnet pack or nuget package and visible to the solution -->
    <None Include="Client\public\umbraco-package.json" Pack="false" />
  </ItemGroup>

  <ItemGroup>
    <Folder Include="wwwroot\" />
  </ItemGroup>

  <!-- Restore and build Client files -->
  <Target Name="RestoreClient" Inputs="Client\package.json;Client\package-lock.json" Outputs="Client\node_modules\.package-lock.json">
    <Message Importance="high" Text="Restoring Client NPM packages..." />
    <Exec Command="npm i" WorkingDirectory="Client" />
  </Target>

  <Target Name="BuildClient" BeforeTargets="AssignTargetPaths" DependsOnTargets="RestoreClient" Inputs="@(ClientAssetsInputs)" Outputs="$(IntermediateOutputPath)client.complete.txt">
    <Message Importance="high" Text="Executing Client NPM build script..." />
    <Exec Command="npm run build" WorkingDirectory="Client" />
    <ItemGroup>
      <_ClientAssetsBuildOutput Include="wwwroot\App_Plugins\**" />
    </ItemGroup>
    <WriteLinesToFile File="$(IntermediateOutputPath)client.complete.txt" Lines="@(_ClientAssetsBuildOutput)" Overwrite="true" />
  </Target>

  <!-- Uses Package Icon on disk in repo -->
  <ItemGroup>
    <None Include="..\..\assets\Icon-transparent.png">
      <Pack>True</Pack>
      <PackagePath>\</PackagePath>
    </None>
    <None Include="..\..\README.md">
      <Pack>True</Pack>
      <PackagePath>\</PackagePath>
    </None>
  </ItemGroup>
  <ItemGroup>
    <PackageReference Update="Nerdbank.GitVersioning" Version="3.7.115" />
  </ItemGroup>

</Project>
